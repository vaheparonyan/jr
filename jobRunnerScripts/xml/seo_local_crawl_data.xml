<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Knowledge_base>

    <!-- sitemap part -->
    <job name="get_sitemap_pages" type="executeBash" 
         command="curl http://seo-content-optimizer.snc1/seoadmin/v1/sitemaps/pages > /home/vparonyan/CrawlSeoPages/current/csv/sitemap.@parameter_date"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters> 
    </job>
    
    <job name="get_sitemap_biz" type="executeBash" 
         command="curl http://seo-content-optimizer.snc1/seoadmin/v1/sitemaps/biz >> /home/vparonyan/CrawlSeoPages/current/csv/sitemap.@parameter_date"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name='get_sitemap_pages'/>
        </dependencies> 
    </job>
    
    <job name="get_sitemap_getaways-pages" type="executeBash" 
         command="curl http://seo-content-optimizer.snc1/seoadmin/v1/sitemaps/getaways-pages >> /home/vparonyan/CrawlSeoPages/current/csv/sitemap.@parameter_date"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name='get_sitemap_biz'/>
        </dependencies> 
    </job>
    
    <job name="empty line into sitemap" type="executeBash" 
         command="echo >> /home/vparonyan/CrawlSeoPages/current/csv/sitemap.@parameter_date"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name='get_sitemap_getaways-pages'/>
        </dependencies> 
    </job>
    
    <job name="dropTable temp sitemap log" type="dropTable" command="temp_kb_sitemap_urls_log" 
         region="na" connectionType="teradata" onerror="Ignore">
        <parameters>
            <keyvalue key="TargetDBName" value="sandbox"/>
        </parameters>
    </job>
    
    <job name="dropTable temp sitemap UV" type="dropTable" command="temp_kb_sitemap_urls_UV" 
         region="na" connectionType="teradata" onerror="Ignore">
        <parameters>
            <keyvalue key="TargetDBName" value="sandbox"/>
        </parameters>
    </job>
    
    <job name="dropTable temp sitemap ET" type="dropTable" command="temp_kb_sitemap_urls_ET" 
         region="na" connectionType="teradata" onerror="Ignore">
        <parameters>
            <keyvalue key="TargetDBName" value="sandbox"/>
        </parameters>
    </job>

    <job name="truncate sitemap temp table" type="executeBash"
         command="tdsql -H @parameter_tdwc -u vparonyan -p LetsDoTDWC12 &#34;
                    delete from sandbox.temp_kb_sitemap_urls all&#34;" 
            region="na">
        <parameters>
            <keyvalue key="tdwc" value="10.20.88.35"/>
        </parameters>
    </job>
    
    <job name="tdload sitemap" type="executeBash" 
         command="tdload -h @parameter_tdwc -u vparonyan -p LetsDoTDWC12 
                  -f /home/vparonyan/CrawlSeoPages/current/csv/sitemap.@parameter_date
                  -t temp_kb_sitemap_urls --TargetWorkingDatabase sandbox" 
         region="na">
        <parameters>
            <keyvalue key="tdwc" value="10.20.88.35"/>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <!--dependent name='twbrmcp'/-->
            <dependent name='truncate sitemap temp table'/>
            <dependent name='dropTable temp sitemap ET'/>
            <dependent name='dropTable temp sitemap UV'/>
            <dependent name='dropTable temp sitemap log'/>
            <dependent name='empty line into sitemap'/>
        </dependencies>
    </job>
    
    <job name="move data from sitremap temp table" type="executeBash"
         command="tdsql -H 10.20.88.35 -u vparonyan -p LetsDoTDWC12 &#34;
                    insert into sandbox.kb_sitemap_urls(datekey, url) select @parameter_date, url from sandbox.temp_kb_sitemap_urls &#34;"
            region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name="tdload sitemap"/>
        </dependencies>
    </job>
    
    <job name="grant select sitemap table" type="executeSimpleQuery" command="grant_select_on_table" 
                            region="na" connectionType="teradata">
        <parameters>
            <keyvalue key="dbname" value="sandbox"/>
            <keyvalue key="tablename" value="kb_sitemap_urls"/>
        </parameters>
        <dependencies>
            <dependent name='move data from sitremap temp table'/>
        </dependencies>
    </job>
    
    
    <!-- kb_seo_local_page_inventory-->
    <job name="get local pages" type="executeBash" 
         command="curl http://seo-content-optimizer.snc1/seoadmin/v1/sitemaps/pages > /home/vparonyan/CrawlSeoPages/current/csv/local_pages.@parameter_date"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters> 
    </job>
    
    <job name="empty line into local" type="executeBash" 
         command="echo >> /home/vparonyan/CrawlSeoPages/current/csv/local_pages.@parameter_date"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name='get local pages'/>
        </dependencies> 
    </job>
    
    <job name="local into local" type="executeBash" 
         command="echo local >> /home/vparonyan/CrawlSeoPages/current/csv/local_pages.@parameter_date"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name='empty line into local'/>
        </dependencies> 
    </job>

    <job name="crawl local pages" type="executeBash" 
         command="cd /home/vparonyan/CrawlSeoPages/current &#38;&#38; java -jar dist/CrawlSeoPages.jar csv/local_pages.@parameter_date > result/crawler.log"
         region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name='local into local'/>
        </dependencies> 
    </job>

    <job name="generate detailed data" type="executeBash" 
         command="cd /home/vparonyan/CrawlSeoPages/current &#38;&#38; java -jar dist/CrawlSeoPages.jar generateData result/seoLocalPagesRawData.tsv result/seoLocalPagesDetailedData.tsv local > result/generate_data.log"
         region="na">
        <parameters>
        </parameters>
        <dependencies>
            <dependent name='crawl local pages'/>
        </dependencies> 
    </job>

    <job name="delete hearder" type="executeBash" 
         command="cd /home/vparonyan/CrawlSeoPages/current &#38;&#38; sed -i 1d result/seoLocalPagesDetailedData.tsv"
         region="na">
        <parameters>
        </parameters>
        <dependencies>
            <dependent name='generate detailed data'/>
        </dependencies> 
    </job>
   
    <job name="dropTable temp data log" type="dropTable" command="temp_kb_seo_local_p_inv_log" 
         region="na" connectionType="teradata" onerror="Ignore">
        <parameters>
            <keyvalue key="TargetDBName" value="sandbox"/>
        </parameters>
    </job>
    
    <job name="dropTable temp data UV" type="dropTable" command="temp_kb_seo_local_p_inv_UV" 
         region="na" connectionType="teradata" onerror="Ignore">
        <parameters>
            <keyvalue key="TargetDBName" value="sandbox"/>
        </parameters>
    </job>
    
    <job name="dropTable temp data ET" type="dropTable" command="temp_kb_seo_local_p_inv_ET" 
         region="na" connectionType="teradata" onerror="Ignore">
        <parameters>
            <keyvalue key="TargetDBName" value="sandbox"/>
        </parameters>
    </job>

    <job name="dropTable temp data table" type="dropTable" command="temp_kb_seo_local_p_inv" 
         region="na" connectionType="teradata" onerror="Ignore">
        <parameters>
            <keyvalue key="TargetDBName" value="sandbox"/>
        </parameters>
    </job>
    
    <job name="createTable temp data table" type="executeBash"
         command="tdsql -H @parameter_tdwc -u vparonyan -p LetsDoTDWC12 &#34;
                    CREATE MULTISET TABLE sandbox.temp_kb_seo_local_p_inv ,NO FALLBACK ,
                    NO BEFORE JOURNAL,
                    NO AFTER JOURNAL,
                    CHECKSUM = DEFAULT,
                    DEFAULT MERGEBLOCKRATIO
                    (
                        id integer,
                        url VARCHAR(2048) CHARACTER SET UNICODE CASESPECIFIC,
                        inboundlinks integer,
                        outboundlinks integer,
                        isinsitemap VARCHAR(5),
                        breadcrumbsdepth integer,
                        depth integer,
                        textlength integer,
                        status VARCHAR(10)
                    )
                    PRIMARY INDEX ( url )&#34;" 
            region="na">
        <parameters>
            <keyvalue key="tdwc" value="10.20.88.35"/>
        </parameters>
        <dependencies>
            <dependent name='dropTable temp data table'/>
            <dependent name='dropTable temp data ET'/>
            <dependent name='dropTable temp data UV'/>
            <dependent name='dropTable temp data log'/>
        </dependencies>
    </job>
    
    <job name="tdload detailed data" type="executeBash" 
         command="tdload -h @parameter_tdwc -u vparonyan -p LetsDoTDWC12 
                  -f /home/vparonyan/CrawlSeoPages/current/result/seoLocalPagesDetailedData.tsv
                  -d TAB -t temp_kb_seo_local_p_inv --TargetWorkingDatabase sandbox" 
         region="na">
        <parameters>
            <keyvalue key="tdwc" value="10.20.88.35"/>
        </parameters>
        <dependencies>
            <!--dependent name='twbrmcp'/-->
            <dependent name='createTable temp data table'/>
            <dependent name='delete hearder'/>
        </dependencies>
    </job>   
        
    <job name="move data from temp data table" type="executeBash"
         command="tdsql -H 10.20.88.35 -u vparonyan -p LetsDoTDWC12 &#34;
                    insert into sandbox.kb_seo_local_page_inventory (datekey, url, inboundlinks, outboundlinks, isinsitemap, breadcrumbsdepth, depth, textlength, status) 
                    select @parameter_date, url, inboundlinks, outboundlinks, isinsitemap, breadcrumbsdepth, depth, textlength, status from sandbox.temp_kb_seo_local_p_inv&#34;"
            region="na">
        <parameters>
            <keyvalue key="date" value="${datekey}"/>
        </parameters>
        <dependencies>
            <dependent name="tdload detailed data"/>
        </dependencies>
    </job>
    
    <job name="grant select data table" type="executeSimpleQuery" command="grant_select_on_table" 
                            region="na" connectionType="teradata">
        <parameters>
            <keyvalue key="dbname" value="sandbox"/>
            <keyvalue key="tablename" value="kb_seo_local_page_inventory"/>
        </parameters>
        <dependencies>
            <dependent name='move data from temp data table'/>
        </dependencies>
    </job>

</Knowledge_base>
